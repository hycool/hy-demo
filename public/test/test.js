this.ajst["views/mod/videoplayer/index.htm"]=function(obj){obj||(obj={});
var __t,__p="";
with(_.escape,obj)__p+='<div class="i-width100p i-height100p" id="mod_videoPlayer">\r\n    <div class="i-width100p i-height100p mod-videoPlayer-playerEntity" id="mod_videoPlayer_playerEntity"\r\n         style="width:2048px;height:1536px;background:black;"></div>\r\n    <div class="mod-videoPlayer-mask i-width100p i-height100p">\r\n        <div style="position: absolute;bottom: 0;width: 100%;">\r\n            <div class="mod-videoPlayer-controls mod-videoPlayer-controls-disabled">\r\n                <div class="i-width100p i-float-left">\r\n                    <div class="mod-videoPlayer-volumeMute"></div>\r\n                    <div class="mod-videoPlayer-volumePanel">\r\n                        <div class="mod-videoPlayer-volumeTrack">\r\n                            <div class="mod-videoPlayer-volumeTrackProgress" style="width: 38px; ">\r\n                                <div class="mod-videoPlayer-volumePlayHead"></div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                    <div class="mod-videoPlayer-volumeFull"></div>\r\n                    <div class="mod-videoPlayer-btnGroup">\r\n                        <div class="mod-videoPlayer-play" style="display:block"></div>\r\n                        <div class="mod-videoPlayer-pause" style="display:none"></div>\r\n                    </div>\r\n                    <div class="mod-videoPlayer-fullScreen"></div>\r\n                    <div class="mod-videoPlayer-restoreScreen" style="display: none;"></div>\r\n                    <div class="mod-videoPlayer-rotate"></div>\r\n                </div>\r\n                <div class="i-width100p i-float-left">\r\n                    <div class="mod-videoPlayer-currentTime">\r\n                        <span class="timeDisplayMin">00</span>:<span class="timeDisplaySec">00</span>\r\n                    </div>\r\n                    <div class="mod-videoPlayer-trackPanel">\r\n                        <div class="mod-videoPlayer-track">\r\n                            <div class="mod-videoPlayer-loadedProgress" style="width: 0px; "></div>\r\n                            <div class="mod-videoPlayer-trackProgress" style="width: 0px; ">\r\n                                <div class="mod-videoPlayer-playHead"></div>\r\n                            </div>\r\n                        </div>\r\n                        <div class=" mod-videoPlayer-track-right-cap-loaded"></div>\r\n                    </div>\r\n                    <div class="mod-videoPlayer-durationDisplay">\r\n                        -<span class="durationMin">00</span>:<span class="durationSec">00</span>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <div class="mod-videoPlayer-loadmask" style="position: absolute;bottom:50%;width:100%;">\r\n            <div class="loading-white-mask" style="position:static;margin:0 auto;"></div>\r\n            <div class="mod-videoPlayer-fluencyTip">'+(null==(__t=Common.video_fluency_tip)?"":__t)+'</div>\r\n        </div>\r\n    </div>\r\n    <div class="full-screen-close" style="display:none;"></div>\r\n    <div id="mod_videoPlayer_formatNoSupportTip" class="mod-videoPlayer-tip" style="display: none;">\r\n        <div class="i-width100p i-height100p" style="display: table;">\r\n            <div class="i-width100p i-height100p" style="display: table-cell;vertical-align: middle;text-align: center">\r\n                <div class="mod-videoPlayer-formatNoSupportTip"></div>\r\n                <br/><br/>\r\n\r\n                <div>'+(null==(__t=UsedLang.Tip_FormatNotSupported)?"":__t)+'</div>\r\n                <br>\r\n                <button type="button" class="btn btn-download">'+(null==(__t=Common.Export)?"":__t)+'</button>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <div id="mod_videoPlayer_tooLargeTip" class="mod-videoPlayer-tip" style="display: none;">\r\n        <div class="i-width100p i-height100p" style="display: table;">\r\n            <div class="i-width100p i-height100p" style="display: table-cell;vertical-align: middle;text-align: center">\r\n                <div class="mod-videoPlayer-tooLargeTip"></div>\r\n                <br/><br/>\r\n\r\n                <div>'+(null==(__t=UsedLang.Tip_VideoTooLarge)?"":__t)+'</div>\r\n                <br>\r\n                <button type="button" class="btn btn-force-play">'+(null==(__t=UsedLang.Btn_PlayAnyway)?"":__t)+'</button>\r\n                <button type="button" class="btn btn-download ml16">'+(null==(__t=Common.Export)?"":__t)+'</button>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <div id="mod_videoPlayer_cannotPlay" class="mod-videoPlayer-tip" style="display: none;">\r\n        <div class="i-width100p i-height100p" style="display: table;">\r\n            <div class="i-width100p i-height100p" style="display: table-cell;vertical-align: middle;text-align: center">\r\n                <div class="mod-videoPlayer-playFail"></div>\r\n                <br/><br/>\r\n\r\n                <div>'+(null==(__t=UsedLang.Tip_CannnotPlay)?"":__t)+'</div>\r\n                <br>\r\n                <button type="button" class="btn btn-download">'+(null==(__t=Common.Export)?"":__t)+"</button>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>";return __p};
Airdroid.Module.VideoPlayerH5=Core.extend(Airdroid.AppBase,{_isPlayerReady:!1,_isFlvPlayer:!1,_isFullScreen:!1,_status:null,_videoInfo:null,_VIDEO_PLAYER_PADDING:50,_SUPPORT_FORMATS_REGEX:/(mov|mkv|mp4|m4v|3gp|webmv|flv)/i,_SIZE_LIMIT:104857600,_MEDIA_DURATIONS:{},_prevVideoSrc:null,_fullscreenDom:null,_rotation:0,events:{"click .mod-videoPlayer-rotate":"rotate90"},
	initialize:function(){
		var e=this.util;
		this._rotation=0,
		this._lang=e.getLang("Video"),
		this._langCommon=e.getLang("Common")},
		rotate90:function(){
			this.setRotate(this._rotation-90)},
			setRotate:function(e){var t=this,i=this._playerEntityDom;i.css("transform","rotate("+this._rotation+"deg)"),this._rotation=e,i.stop(),i.transit({transform:"rotate("+e+"deg)"},1e3,function(){t.util.isFullScreen()||t._isFullScreen?t.setPlayerToFullscreenSize():t.setInitSize()})},onCreate:function(){window.vph5=this;var e,t;console.log("VideoPlayerH5"),e=this.util;var i=this;t=this._refDOM=$(e.getTemplate("mod/videoplayer","index",{UsedLang:this._lang,Common:this._langCommon})),t.mouseenter(function(){i.showControls()}),t.mouseleave(function(){i.hideControls()}),$.browser.msie||t.mousemove(function(){i.showControls()}),this._playerEntityDom=t.find(".mod-videoPlayer-playerEntity"),this._controlsDom=t.find(".mod-videoPlayer-controls"),this._durationDisplayDom=t.find(".mod-videoPlayer-durationDisplay"),this._loadedProgressDom=t.find(".mod-videoPlayer-loadedProgress"),this._playHeadDom=t.find(".mod-videoPlayer-playHead"),this._volumePlayHeadDom=t.find(".mod-videoPlayer-volumePlayHead"),this._volumeMuteDom=t.find(".mod-videoPlayer-volumeMute"),this._loadmaskDom=t.find(".mod-videoPlayer-loadmask"),this._downloadBtnDom=t.find(".btn-download"),this._forcePlayBtnDom=t.find(".btn-force-play"),this._fullScreenBtnDom=t.find(".mod-videoPlayer-fullScreen"),this._restoreScreenBtnDom=t.find(".mod-videoPlayer-restoreScreen"),this._fullscreenCloseBtnDom=t.find(".full-screen-close"),this.setContent(t)},onCreated:function(){this._playHeadDom.css("cursor","auto"),this.initTipBtnActions()},setInitSize:function(){var e=this.setPlayerToNormalSize();this.setBodySize(e.width,e.height),this.setInitPosition()},
			
			initJPlayer:function(e){
				var t=$.Deferred(),i=this;
				return this._playerEntityDom.jPlayer({
					ready:function(){i._isPlayerReady=!0,i._isFlvPlayer="flv"===e,t.resolve()},
					loadedmetadata:function(e){i._status=e.jPlayer.status,i.util.isFullScreen()?i.setPlayerToFullscreenSize():i._status.src!==i._prevVideoSrc?(i.setInitSize(),i.setInitPosition()):i.setJPlayerSize(i.getBodyWidth(),i.getBodyHeight()),i._prevVideoSrc=i._status.src,i.enableControls(),i.hideVideoLoadingMask()},
					progress:function(e){var t=e.jPlayer.status;i._loadedProgressDom.css("width",t.seekPercent+"%")},
					volumechange:function(){i._volumePlayHeadDom.css("left","auto")},
					timeupdate:function(e){var t=e.jPlayer.status,n=i._MEDIA_DURATIONS[i._videoInfo.url]||t.duration||i._videoInfo.duration/1e3||0;i._MEDIA_DURATIONS[i._videoInfo.url]=n;var o=Math.floor(n-t.currentTime);i.updateRestTime(o)},
					ended:function(){},
					error:function(e){console.log(e),i.onError()},
					cssSelectorAncestor:".mod-videoPlayer-controls",
					cssSelector:{play:".mod-videoPlayer-play",pause:".mod-videoPlayer-pause",volumeBar:".mod-videoPlayer-volumeTrack",volumeBarValue:".mod-videoPlayer-volumeTrackProgress",volumeMax:".mod-videoPlayer-volumeFull",seekBar:".mod-videoPlayer-track",playBar:".mod-videoPlayer-trackProgress",currentTime:".mod-videoPlayer-currentTime"},size:{width:"640px",height:"430px"},swfPath:Airdroid.Config.baseUri+"assets/swf",supplied:e||"webmv, ogv, m4v",keyEnabled:!0,keyBindings:{fullScreen:!1}}),this.initVolumeControlActions(),this.initFullScreenBtnsActions(),t},
					initFlvJplayer:function(){return this.initJPlayer("flv")},onError:function(){this.util.OS.ChromeOs?this.showCannotPlay():(this.runApp(this.config.dependApps.videoPlayer,this._videoInfo),this.destroy())},initFullScreenBtnsActions:function(){var e=this;(Airdroid.Util.browser.ie9||Airdroid.Util.browser.ie10)&&this._fullScreenBtnDom.hide(),this._fullScreenBtnDom.click(function(){e._isFullScreen=!0,e.refDomToFullpageSize(),$("document").bind("keydown",function(t){27==t.which&&(e._isFullScreen=!1,$(this).unbind())}),e.util.fullScreen(e._refDOM.get(0),function(){e.refDomToNormalSize(),setTimeout(function(){e.setInitSize()},500),e._restoreScreenBtnDom.hide(),e._fullScreenBtnDom.show()}),setTimeout(function(){e.setPlayerToFullscreenSize()},500),e._fullScreenBtnDom.hide(),e._restoreScreenBtnDom.show()}),this._restoreScreenBtnDom.add(this._fullscreenCloseBtnDom).click(function(){e._isFullScreen=!1,e.refDomToNormalSize(),e.util.cancelFullScreen(),setTimeout(function(){e.setInitSize()},500),e._restoreScreenBtnDom.hide(),e._fullScreenBtnDom.show()})},setPlayerToNormalSize:function(){var e,t,i,n=this;return e=this.getCurrVideoWidth()||640,t=this.getCurrVideoHeight()||480,i=this.calculatePlayerSize(e,t,this._VIDEO_PLAYER_PADDING),this._playerEntityDom.add(this._playerEntityDom.find("video")).animate({width:i.width,height:i.height},function(){n.setJPlayerSize(i.width,i.height),n._playerEntityDom.css("marginTop","auto")}),i},getCurrVideoWidth:function(){return 0===this._rotation%180?this._status.videoWidth:this._status.videoHeight},getCurrVideoHeight:function(){return 0===this._rotation%180?this._status.videoHeight:this._status.videoWidth},setPlayerToFullscreenSize:function(){var e,t,i,n,o=this;return this.util.isFullScreen()?(e=window.screen,t=e.width,i=e.height):(n=document.body,t=n.clientWidth,i=n.clientHeight),0===this._rotation%180?(o.setJPlayerSize(t,i),o._playerEntityDom.css("marginTop","auto")):(o.setJPlayerSize(i,t),o._playerEntityDom.css("marginTop",(i-t)/2)),{width:t,height:i}},refDomToNormalSize:function(){this._refDOM.removeAttr("style"),this._fullscreenCloseBtnDom.hide(),this._refDOM.find(".content_area").css("overflow","hidden"),this._refDOM.find(".window_content").css("overflow","hidden"),Airdroid.TaskbarManage.showTaskBar()},refDomToFullpageSize:function(){this._refDOM.css({position:"fixed",top:0,left:0,width:"100%",height:"100%",zIndex:1e7}),this._fullscreenCloseBtnDom.show(),this._refDOM.find(".content_area").css("overflow","visible"),this._refDOM.parents(".window_content").css("overflow","visible"),Airdroid.TaskbarManage.hideTaskBar()},onDataChange:function(e){var t=e.data;return this._videoInfo=t,this.updateTitle(t.name),this.disableControls(),this.hideTips(),this.isTooLarge()?(this.showTooLarge(),void 0):this.isSupportFormat(t.format)?(this.play(t.url),void 0):(this.showNoSupport(),void 0)},onResize:function(e){var t=e.data,i=t.width,n=t.height;this.setJPlayerSize(i,n)},onClose:function(){},initTipBtnActions:function(){var e=this;this._downloadBtnDom.click(function(){e.util.download(e._videoInfo.download)}),this._forcePlayBtnDom.click(function(){console.log("btn-force-play"),e.hideTips(),e.play(e._videoInfo.url)})},initVolumeControlActions:function(){var e=this;this._volumeMuteDom.click(function(){e.setVolume(0)});var t=function(t,i){var n=i.position.left/39;e.setVolume(n)};this._volumePlayHeadDom.draggable({containment:".mod-videoPlayer-volumePanel",axis:"x",drag:t,stop:t})},updateRestTime:function(e){if(!(0>e)){var t=function(e){return e=Math.floor(e),10>e?"0"+e:e},i=t(e/60/60),n=t(e/60%60),o=t(e%60),a=n+":"+o;i>0&&(a=i+":"+a),this._durationDisplayDom.text("-"+a)}},calculatePlayerSize:function(e,t,i){var n,o,a,r,s,l,d,c,u=640,h=480;return o=window.screen,i=i||0,n=Airdroid.DesktopManage._currentDesktop._desktopDom,this.util.isFullScreen()?(a=o.width,r=o.height):(a=n.width()-i,r=n.height()-i),s=Math.min(e,a),l=Math.min(t,r),d=Math.min(s,l/t*e),c=Math.min(l,s/e*t),d=Math.max(d,u),c=Math.max(c,h),{width:d,height:c}},setMedia:function(e){this._playerEntityDom.jPlayer("setMedia",{m4v:e})},setFlvMedia:function(e){this._playerEntityDom.jPlayer("setMedia",{flv:e})},setJPlayerSize:function(e,t){console.log("："+e+",："+t),this._playerEntityDom.jPlayer({size:{width:e,height:t}})},canPlay:function(){return this._isFlvPlayer&&"flv"===this._videoInfo.format||!this._isFlvPlayer&&"flv"!==this._videoInfo.format},play:function(e){this.showVideoLoadingMask();var t=function(){e&&n(e),i.jPlayer("play")},i=this._playerEntityDom,n=this.setMedia.bind(this),o=this.initJPlayer.bind(this);if("flv"===this._videoInfo.format&&(n=this.setFlvMedia.bind(this),o=this.initFlvJplayer.bind(this)),this._isPlayerReady){if(this.canPlay())return t(),void 0;i.jPlayer("destroy")}i.children("audio").length>0&&i.jPlayer("destroy"),o().then(t)},setVolume:function(e){this._playerEntityDom.jPlayer("volume",e)},showVideoLoadingMask:function(){this._loadmaskDom.show()},hideVideoLoadingMask:function(){this._loadmaskDom.hide()},showControls:function(){this._controlsDom.addClass("fshow")},hideControls:function(){this._controlsDom.removeClass("fshow")},enableControls:function(){this._controlsDom.removeClass("mod-videoPlayer-controls-disabled")},disableControls:function(){this._controlsDom.addClass("mod-videoPlayer-controls-disabled")},showNoSupport:function(){this.showTip("formatNoSupportTip")},showCannotPlay:function(){this.showTip("cannotPlay")},showTooLarge:function(){this.showTip("tooLargeTip")},showTip:function(e){this.hideTips(),this._refDOM.find("#mod_videoPlayer_"+e).show()},hideTips:function(){this._refDOM.find(".mod-videoPlayer-tip").hide()},isTooLarge:function(){return(this._videoInfo.oriSize||0)>this._SIZE_LIMIT},isSupportFormat:function(e){return this._SUPPORT_FORMATS_REGEX.test(e)}});