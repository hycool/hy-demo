"use strict";
angular.module("IMGOTVM").controller("C_Index",function($scope,SERVICE,$rootScope)
		{
	function showGuide(){main.addClass("main-hide"),guide.show()}
	function unShowGuid(){main.removeClass("main-hide"),guide.hide(),$(window).scrollTop(0)}
	$scope.cName="index",
	$.fn.cookie("tab",null),
	$rootScope.pageTitle="",
	$scope.sliderData=[],
	$scope.listData=[],
	$scope.nomoreCheck=!1,
	$scope.guidIMG="",
	$scope.checkIMG="image/uncheck.png";
	var guide=$(".guide"),
	main=$("#main"),
	isShowGuide=$.fn.cookie("sg");
	1!=isShowGuide&&1!=$.fn.cookie("tempclose")?($scope.guidIMG="http://m.hunantv.com/image/guide.jpg",$(".guide img").on("load",function(){showGuide()}),$(".gk").attr("href",appURL.jump+"fr=cover")):unShowGuid(),
			$scope.skip=function(){unShowGuid(),$.fn.cookie("tempclose",1),$scope.nomoreCheck&&$.fn.cookie("sg",1)},$scope.nomore=function(){$scope.nomoreCheck=!$scope.nomoreCheck,$scope.checkIMG=$scope.nomoreCheck?"image/check.png":"image/uncheck.png"},$scope.flowData=[],SERVICE.getModelsData({channelId:1007}).then(function(_data){$scope.flowData=_data.data.data})}),angular.module("IMGOTVM").controller("C_Live",function($scope){$scope.cName="live",$("#live-play").height($("#live-play").width()/16*9)}).controller("C_LiveYNJ",function($scope,SERVICE){$scope.cName="live",$("#live-play").height($("#live-play").width()/16*9),SERVICE.getYNJLiveSrc().then(function(_data){$("#player").attr("src",_data.data.m3u8)})}),angular.module("IMGOTVM").controller("C_Play",function($scope,SERVICE,$sce,$rootScope,$routeParams){$scope.cName="play",$scope.downloadUrl="",$scope.relatedShow=!1,$scope.xjShow=!1,$scope.descShow=!1,$scope.playerShow=!1,$scope.commentShow=!1,$scope.showHD=!1,$scope.currentTime=0,$scope.hdWidth="",$scope.isOver30=!1,$scope.is30m=!1,$scope.isNotVip=!0,$scope.thirty_min=420,$scope.commentList=[];var currentTab=1,cookieTab=$.fn.cookie("tab"),param=$routeParams.id.split(","),opt={expires:7},listIndex=0,win=$(window);$scope.video_id=param[0],$rootScope.video_id=$scope.video_id,window.seekTime=param[1]||0,$scope.trustSrc=function(src){return $sce.trustAsResourceUrl(src)},$scope.overBannerClick=function(){$scope.is30m=!1},$scope.xjClick=function(){$scope.relatedShow=!1,$scope.xjShow=!0,$scope.descShow=!1,$scope.commentShow=!1,currentTab=1,listIndex=0,$.fn.cookie("tab",currentTab,opt)},$scope.descClick=function(){$scope.relatedShow=!1,$scope.xjShow=!1,$scope.descShow=!0,$scope.commentShow=!1},$scope.relatedClick=function(){$scope.relatedShow=!0,$scope.xjShow=!1,$scope.descShow=!1,$scope.commentShow=!1,currentTab=2,listIndex=1,$.fn.cookie("tab",currentTab,opt)},$scope.commentClick=function(){$scope.relatedShow=!1,$scope.xjShow=!1,$scope.descShow=!1,$scope.commentShow=!0,0==$scope.commentList.length&&SERVICE.getCommentList({subject_id:$scope.video_id,type:"hunantv2014"}).then(function(_data){$scope.commentList=_data.data.comments.slice(0,5)})},$scope.switchRate=function(ele){$scope.showHD=!$scope.showHD,$scope.currentTime=$("#player")[0].currentTime,$scope.hdWidth="width:"+($(ele).width()-18)+"px"};var ua=navigator.userAgent.toLowerCase();$scope.quality=ua.indexOf("iphone")>-1?"标清":"流畅",win.on("over30",function(){$scope.$apply(function(){$scope.isOver30=!0})}),SERVICE.getRelatedVideoList({videoId:$scope.video_id}).then(function(_data){$scope.relatedlist=_data.data.data}),SERVICE.getVideoList({videoId:$scope.video_id}).then(function(_data){var list=_data.data.data;$scope.list=list;var cid=setInterval(function(){if($scope.detail&&!isNaN($scope.detail.rootid)){var rootid=$scope.detail.rootid;if(2==rootid||7==rootid){if(list.length%5!=0)for(var s=5-list.length%5,i=0;s>i;i++)list.push({desc:"",downloadUrl:"",image:"",name:"",playCount:"",time:0,videoId:0,videoIndex:0});clearInterval(cid)}else isNaN(rootid)||2==rootid||clearInterval(cid)}$scope.$apply(function(){$scope.list=list})},200);1==cookieTab?$scope.xjClick():2==cookieTab?$scope.relatedClick():($scope.list.length>1,$scope.xjClick())}),SERVICE.getVideoInfo({videoId:$scope.video_id}).then(function(_data){window.videoInfo=$scope.videoInfo=_data.data.data,STA.init(),$rootScope.simpleTitle=$scope.videoInfo.detail.name,$rootScope.pageTitle=$scope.videoInfo.detail.name+" -- ",window.detail=$scope.detail=$scope.videoInfo.detail,$scope.isNotVip=0===~~$scope.detail.isvip,$rootScope.desc=$scope.detail.desc,$scope.director="主持人",(2==$scope.detail.rootid||3==$scope.detail.rootid)&&($scope.director="导演"),$scope.videoInfo.detail.time>=$scope.thirty_min&&($scope.is30m=!0),""!=$scope.detail.player&&4!=$scope.detail.rootid&&7!=$scope.detail.rootid&&($scope.playerShow=!0),$rootScope.poster=$scope.poster=$scope.detail.image,$scope.isNotVip&&player("live-play",{swf:"",vars:"",m3u8_url:$scope.videoInfo.m3u8Url,mp4_url:$scope.videoInfo.mp4Url,type:$scope.detail.typeId,vid:$scope.detail.videoId,cid:$scope.detail.cid,definition:$scope.detail.definition,next_url:"",over_min:$scope.thirty_min,poster:$scope.poster}),"undefined"!=typeof window.WXApi&&(window.WXApi.setTitle($scope.videoInfo.detail.name),window.WXApi.setLink($scope.videoInfo.detail.pcUrl),window.WXApi.setDesc($scope.videoInfo.detail.desc),window.WXApi.setImage($scope.videoInfo.detail.image))}),$("#live-play").height($("#live-play").width()/16*9),$scope.$on("$destroy",function(){win.trigger("destroy"),$("#player").length>0&&$("#player").remove()})}),angular.module("IMGOTVM").controller("C_Search",function($scope,SERVICE,$rootScope){function search(txt){SERVICE.getSearchResult({name:txt}).then(function(_data){var data=_data.data.data;$scope.searchStr=txt,SERVICE.searchHistory(txt),$scope.relatedVideoNum=data.relatedVideo.length+data.otherVideo.length,$scope.relatedVideoList=data.relatedVideo.concat(data.otherVideo),$scope.listShow=!1,$scope.searchVideoShow=!0})}$scope.cName="search",$.fn.cookie("tab",null),$rootScope.pageTitle="搜索 -- ";var searchTxt=$("#searchTxt"),searchListStr=($("#historyBox"),$("#history-con"),$(".search-list"),$(".search-result"),SERVICE.searchHistory());$scope.listShow=!0,$scope.searchVideoShow=!1,SERVICE.getHotSearch().then(function(_data){$scope.hotSearch=_data.data.data}),$scope.cancelClick=function(){search($.trim(searchTxt.val()))},$scope.clearClick=function(){SERVICE.clearSearchHistory(),$scope.searchList=[],$scope.historyConShow=!1},$scope.searchClick=function(target){var searchWord=$.trim($(target).html());searchTxt.val(searchWord),search(searchWord)},searchListStr&&($scope.searchList=searchListStr.reverse(),$scope.searchList.length>0&&($scope.historyConShow=!0)),searchTxt.on("keyup",function(evt){13==evt.keyCode&&search($.trim(searchTxt.val()))})}),angular.module("IMGOTVM").controller("C_Select",function($scope,SERVICE,$rootScope){$scope.cName="select",$rootScope.pageTitle="精选 -- ";var guide=$(".guide"),main=$("#main");main.removeClass("main-hide"),guide.hide(),SERVICE.getRecData().then(function(_data){$scope.listData=_data.data.data.rec})}),angular.module("IMGOTVM").controller("C_Sort",function($scope,SERVICE,$rootScope,$routeParams){function filterSort(nav_id){$.each(allSort,function(index,item){return item.type==nav_id?($scope.sortObj=item.filterItems,$scope.sortParam={},$.each($scope.sortObj,function(index,item){$scope.sortParam[item.filtertype]=item.filters[0].id}),!1):void 0}),$scope.$broadcast("refresh")}function whenScroll(){$(document).height()-(_w.scrollTop()+_w.height())<range&&!ajaxing&&(++currentPage,ajaxing=!0,SERVICE.getSortData($.extend(getData,{pageCount:currentPage})).then(function(_data){$scope.imgList=$scope.imgList.concat(_data.data.data),ajaxing=!1}))}function bindEvent(){$scope.$on("orderChange",function(e,data){currentPage=1,currentOrder=data.order,SERVICE.getSortData($.extend(getData,{pageCount:currentPage,order:currentOrder})).then(function(_data){$scope.imgList=_data.data.data})}),$scope.$on("detailChange",function(e,data){currentPage=1,getData=$.extend(getData,data),SERVICE.getSortData($.extend(getData,{pageCount:currentPage,order:currentOrder})).then(function(_data){$scope.imgList=_data.data.data})}),$scope.$on("$destroy",function(){getData=null,$scope.imgList=null}),_w.on("scroll",whenScroll)}$scope.cName="sort",$scope.nav_id=$routeParams.id,$scope.sortObj=[],$.fn.cookie("tab",null);var allSort=SERVICE.videoSort(),currentPage=1,currentOrder=2,range=10,channalName={show:"综艺频道",tv:"电视剧频道",movie:"电影频道",music:"音乐频道",cartoon:"卡通频道",news:"新闻频道",doco:"纪录片频道",life:"生活频道"},getData={type:$scope.nav_id,pageCount:currentPage,order:currentOrder},ajaxing=!1,_w=$(window);return channalName.hasOwnProperty($scope.nav_id)?($rootScope.pageTitle=channalName[$scope.nav_id]+" -- ",null==allSort?SERVICE.getCategorys().then(function(_data){allSort=_data.data.data,filterSort($scope.nav_id)}):filterSort($scope.nav_id),bindEvent(),void SERVICE.getSortData(getData).then(function(_data){$scope.imgList=_data.data.data})):void window.history.go(-1)}),angular.module("IMGOTVM").controller("C_Topic",function($scope,SERVICE,$rootScope,$routeParams){$scope.cName="index",$rootScope.pageTitle="",$scope.flowData=[],SERVICE.getSpecialData({subjectId:$routeParams.subject_id}).then(function(_data){$scope.flowData=_data.data.data})});